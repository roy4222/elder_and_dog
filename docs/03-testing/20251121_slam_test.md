# SLAM + Nav2 測試紀錄 - 2025/11/21

## 實驗目標
1. **Phase 1 (小空間，1-2 坪)**：驗證 SLAM + Nav2 基本通訊與流程
2. **Phase 2 (大空間，4-5 坪+)**：完整建圖、導航、避障、巡邏

---

## Phase 1 - 小空間基本驗證

### 環境檢查
- [ ] 時間同步 (date 確認)
- [ ] 無落地鏡或大面積玻璃
- [ ] WiFi 訊號良好

### Step 1：驅動啟動
**時間開始：** ___

```bash
Terminal 1: bash start_go2_simple.sh
```

**檢查項：**
- [ ] "Video frame received for robot 0" 出現
- **結果：** ___（成功/失敗）
- **備註：** ___

---

### Step 2：ROS2 環境準備
**時間：** ___

```bash
Terminal 2:
source /opt/ros/humble/setup.bash
cd /home/roy422/elder_and_dog && source install/setup.bash
export ROBOT_IP="192.168.12.1"
```

**驗證 /scan 頻率：**
```bash
ros2 topic hz /scan
```

- **/scan 頻率：** ___ Hz （預期 > 5 Hz）
- **頻寬狀態：** ✓ 正常 / ⚠️ 接近限制 / ❌ 嚴重耗盡

---

### Step 3：啟動 SLAM + Nav2
**時間：** ___

```bash
Terminal 3:
ros2 launch go2_robot_sdk robot.launch.py slam:=true nav2:=true rviz2:=true
```

**預期項目：**
- [ ] RViz 視窗開啟
- [ ] Fixed Frame = "map"
- [ ] 無明顯錯誤日誌

**【關鍵】RViz 頻寬優化：**
```
☑️ 已取消勾選 "Image" 顯示
☑️ 已取消勾選 "PointCloud2" 顯示
☑️ 保留 "Map", "TF", "RobotModel"
```

---

### Step 4：建圖驗證 (Phase 1)
**時間：** ___

**操作：**
1. RViz SlamToolboxPlugin → "Start At Dock"
2. Terminal 4 移動機器人：
   ```bash
   bash TEST.sh forward    # 3 秒
   bash TEST.sh left       # 3 秒
   bash TEST.sh forward    # 3 秒
   ```

**驗證結果：**
- [ ] RViz 顯示地圖網格更新（白色/黑色像素）
- [ ] `/map` 發佈頻率：___ Hz （預期 ~1 Hz）
- [ ] 地圖品質：簡陋但有畫面 ✓
- [ ] **/scan 頻率保持穩定** > 5 Hz：✓

**地圖外觀描述：** ___

---

### Step 5：TF 樹驗證
**時間：** ___

```bash
Terminal 2: ros2 run tf2_tools view_frames
```

**檢查項：**
- [ ] 完整鏈路：map → odom → base_link
- [ ] 無異常斷鏈
- **結果：** ✓ 通過 / ❌ 有問題：___

---

### Step 6：地圖存檔
**時間：** ___

```bash
Terminal 2:
mkdir -p /home/roy422/elder_and_dog/src/go2_robot_sdk/maps
ros2 run nav2_map_server map_saver_cli -f /home/roy422/elder_and_dog/src/go2_robot_sdk/maps/phase1_test
```

**檢查項：**
- [ ] `phase1_test.yaml` 生成
- [ ] `phase1_test.pgm` 生成
- **檔案大小：** yaml ___ bytes，pgm ___ bytes

---

### Step 7：Nav2 Costmap 初始化檢查
**時間：** ___

**RViz 觀察：**
- [ ] 是否看到彩色障礙物層環繞機器狗（Local Costmap）
- [ ] 是否看到地圖周圍膨脹層（Global Costmap）

**狀態：**
- **Costmap 初始化：** ✓ 已出現 / ⏳ 等待中（耗時 ___ 秒） / ❌ 未出現

---

### Step 8：Nav2 單點導航驗證
**時間：** ___

**RViz 操作：**
1. Navigation2 Plugin → "2D Goal" 按鈕
2. 點擊距起點 0.3-0.5 公尺位置
3. 拖曳設定朝向

**結果：**
- [ ] 出現綠色規劃路徑
- [ ] 機器狗自動移動
- [ ] 機器狗到達目標
- **導航耗時：** ___ 秒
- **成功/失敗：** ✓ 成功 / ❌ 失敗（原因：___）

---

## Phase 1 統計

| 項目 | 結果 | 備註 |
|------|------|------|
| **所有驅動啟動** | ✓ | |
| **/scan 頻率** | ___ Hz | 預期 > 5Hz |
| **SLAM 建圖** | ✓ | 小地圖 |
| **TF 樹** | ✓ | map → odom → base_link |
| **地圖存檔** | ✓ | .yaml + .pgm |
| **Nav2 Costmap** | ✓ | Local + Global 都見 |
| **單點導航** | ✓ | 自動到達 |

**Phase 1 總體評分：** ___ / 10

**主要瓶頸或問題：**
- ___

---

## Phase 2 - 大空間完整評估

### 環境擴大準備
**時間開始：** ___

- [ ] 清出 4-5 坪連續空間
- [ ] 放置 3-5 個障礙物
- [ ] 標記起點位置

### Step 1：詳細建圖
**時間：** ___

**運動模式：** Z 字形 / 方形迴圈 / 自由探索

**操作指令：**
```bash
# 重複移動 10-15 分鐘
bash TEST.sh forward
bash TEST.sh left
bash TEST.sh forward
# ...
```

**建圖耗時：** ___ 分鐘

**迴圈閉合驗證：**
- 機器狗返回起點時，地圖對齐情況：___
- 偏移量估計：___ cm（預期 < 5cm）
- **迴圈閉合：** ✓ 成功 / ⚠️ 部分成功 / ❌ 失敗

---

### Step 2：地圖存檔 (Phase 2)
**時間：** ___

```bash
ros2 run nav2_map_server map_saver_cli -f /home/roy422/elder_and_dog/src/go2_robot_sdk/maps/phase2_large
```

- [ ] `phase2_large.yaml` 生成
- [ ] `phase2_large.pgm` 生成

---

### Step 3：多點導航測試 (5 點)
**時間：** ___

**座標選擇方法：**
使用 RViz "Publish Point" 工具，點擊 Costmap 中的白色區域（安全區），複製座標。

**5 個導航測試點：**

| 點號 | 座標 (x, y) | 成功/失敗 | 耗時 (秒) | 備註 |
|------|------------|---------|---------|------|
| 1 | (___, ___) | ✓/❌ | ___ | |
| 2 | (___, ___) | ✓/❌ | ___ | |
| 3 | (___, ___) | ✓/❌ | ___ | |
| 4 | (___, ___) | ✓/❌ | ___ | |
| 5 | (___, ___) | ✓/❌ | ___ | |

**成功率：** ___ % ( _/5 )

**失敗原因（若有）：**
- ___

---

### Step 4：避障動態測試
**時間：** ___

**操作：** 機器狗導航途中放置障礙物

**測試 1：**
- 路線：起點 → 目標
- 障礙物放置位置：___
- 避障反應時間：___ 秒
- 結果：✓ 順利繞過 / ⚠️ 延遲過久 / ❌ 無反應

**測試 2：**
- 路線：___
- 障礙物放置位置：___
- 避障反應時間：___ 秒
- 結果：✓ / ⚠️ / ❌

---

### Step 5：完整巡邏迴圈測試
**時間：** ___

**編輯巡邏點：**
```yaml
patrol_points: [
  [___, ___],
  [___, ___],
  [___, ___],
  [___, ___],
  [___, ___],
  [___, ___],
]
```

**啟動指令：**
```bash
ros2 run search_logic simple_patrol_node --ros-args -p auto_start:=true
```

**監控：**
```bash
ros2 topic echo /patrol_status
```

**測試結果（監測 2 個完整迴圈）：**

| 迴圈 | 完整迴圈耗時 | 失敗點 | 總體評價 |
|------|-----------|-------|--------|
| 迴圈 1 | ___ 分鐘 | ___ | ✓/⚠️/❌ |
| 迴圈 2 | ___ 分鐘 | ___ | ✓/⚠️/❌ |

**巡邏穩定性：** ___ % （無失敗 = 100%）

---

## Phase 2 統計

| 項目 | 結果 | 標準 |
|------|------|------|
| **迴圈閉合偏移** | ___ cm | < 5 cm ✓ |
| **5 點導航成功率** | ___ % | >= 80% ✓ |
| **避障反應時間** | ___ 秒 | < 3 秒 ✓ |
| **巡邏穩定性** | ___ % | >= 90% ✓ |

**Phase 2 總體評分：** ___ / 10

---

## 總體發現與建議

### 發現的問題
1. ___
2. ___

### 參數調整建議

**SLAM 參數 (`mapper_params_online_async.yaml`)：**
- `loop_match_minimum_response_fine`: 0.45 → 建議改為 ___
- 其他調整：___

**Nav2 參數 (`nav2_params.yaml`)：**
- `max_vel_x`: 3.0 → 建議改為 ___ (當前環境太快/太慢)
- `inflation_radius`: ___ (避障靈敏度調整)
- 其他調整：___

### 後續開發建議
1. ___
2. ___

---

**測試完成日期：** ___
**測試人員：** ___
**總耗時：** ___ 小時
**系統評估：** ready for VLM + 尋物 FSM 開發 ✓ / 需進一步調整 ❌
