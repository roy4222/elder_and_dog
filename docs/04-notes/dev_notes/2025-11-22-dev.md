
---

# 📅 開發日誌：Go2 機器狗環境建置與雙網卡雙通突破

**日期**：2025/11/23 (Sat)
**作者**：Roy
**專案**：Elder and Dog (Go2 智慧尋物系統)
**環境**：macOS (Apple Silicon) + UTM (Ubuntu 22.04 VM) + ROS2 Humble

---

## 🎯 本日目標
1.  完成 Ubuntu 22.04 虛擬機與 ROS2 Humble 基礎環境建置。
2.  解決 macOS UTM 虛擬機無法同時「連網際網路 (Codex)」與「連機器狗 (Go2)」的網路衝突。
3.  完成專案程式碼 (`elder_and_dog`) 下載、編譯與實機連線驗證。

---

## 🏆 核心成就：S 級「雙網卡」架構 (Dual NICs Setup)

為了解決 Mac 連接機器狗 Wi-Fi 後會斷網，導致無法使用 VS Code Copilot/Codex 與 GitHub 的問題，今日成功建置了 **雙網卡分流架構**：

### 1. 網路拓樸設計
*   **網卡 1 (`enp0s1`) - Shared Network**：
    *   透過 Mac 的有線/主網路連線。
    *   負責：網際網路存取 (Google, GitHub, AI 輔助)。
*   **網卡 2 (`enp0s2`) - Bridged Network (Bridged to Wi-Fi)**：
    *   透過 Mac 的 Wi-Fi 介面直接與機器狗熱點 (`Go2-xxxx`) 溝通。
    *   負責：ROS2 機器人控制訊號 (WebRTC/DDS)。
    *   **固定 IP**：`192.168.12.222` (與機器狗 `192.168.12.1` 同網段)。

### 2. 關鍵設定指令 (Manual Static IP & Route)
解決了 UTM 橋接模式無法自動獲取 IP 的問題，並排除了 `169.254.x.x` 干擾 IP。

```bash
# 關閉防火牆 (避免擋住 WebRTC UDP)
sudo ufw disable

# 清除雜訊 IP
sudo ip addr flush dev enp0s2

# 手動設定靜態 IP 與啟動網卡
sudo ip addr add 192.168.12.222/24 dev enp0s2
sudo ip link set enp0s2 up

# 設定靜態路由 (指定去 192.168.12.x 走第二張卡)
sudo ip route add 192.168.12.0/24 dev enp0s2
```

### 3. 驗收結果
達成「雙通」完美狀態：
*   ✅ `ping google.com` → **通** (延遲 3ms)
*   ✅ `ping 192.168.12.1` → **通** (延遲 10ms)

---

## 🛠️ 開發環境優化

### 1. VS Code Remote - SSH
*   成功設定 Mac 本機 VS Code 透過 SSH (`roy422@192.168.64.2`) 連線至 Ubuntu VM。
*   安裝遠端插件：Python, C/C++, ROS，實現語法高亮與自動補全。

### 2. 終端機效率升級 (Zsh + Oh My Zsh)
*   將預設 Shell 從 Bash 切換為 **Zsh**。
*   安裝 `zsh-autosuggestions` 與 `zsh-syntax-highlighting`，大幅提升指令輸入效率。
*   解決了切換 Shell 後 ROS2 環境變數失效的問題 (將 setup 腳本加入 `.zshrc`)。

### 3. 專案編譯
*   切換倉庫源：移除單純 SDK，改用整合版 `elder_and_dog`。
*   編譯測試：`colcon build` 成功，7 個 packages 全數通過 (無 stderr)。

---

## 🐛 遇到的問題與解決 (Troubleshooting)

| 問題現象 | 原因分析 | 解決方案 |
| :--- | :--- | :--- |
| **Host Unreachable** | Mac Wi-Fi 自動切換回有網際網路的 AP，導致橋接中斷。 | 手動將 Mac Wi-Fi 切回 Go2 熱點，並重啟網卡 `ip link set down/up`。 |
| **DTLS Timeout** | 網卡混雜了 `169.254.x.x` 自動配置 IP，導致 WebRTC 握手走錯路。 | 使用 `ip addr flush` 強制清除雜訊 IP，只保留 `192.168.12.222`。 |
| **Command not found** | 切換到 Zsh 後，原本 `.bashrc` 的 ROS2 設定沒載入。 | 將 `source /opt/ros/humble/setup.zsh` 加入 `.zshrc`。 |

---

## 📝 下一步計畫
1.  將手動連線指令封裝成 Alias (`connect_dog`)，避免每次開機重打。
2.  開始測試 `elder_and_dog` 中的尋物邏輯節點。
3.  驗證 Rviz2 是否能即時看到機器狗的 LiDAR 點雲與 Camera 影像。

---

> **總結**：今日完成了從「環境建置」到「實機連線」的最關鍵一哩路。現在擁有一個可以同時寫 Code (有 Copilot 支援) 且同時控制機器狗的頂級開發環境。